

Функция ПолучитьПараметрКомпоновщика(ИмяПараметра) Экспорт
	
	ПараметрДанных = КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти(ИмяПараметра);
	        
	ПараметрПользовательскойНастройки = КомпоновщикНастроек.ПользовательскиеНастройки.Элементы.Найти(ПараметрДанных.ИдентификаторПользовательскойНастройки);
	
	Возврат ПараметрПользовательскойНастройки.Значение;
	    
КонецФункции

Функция ПолучитьПараметрСКД(ИмяПараметра) Экспорт
	СхемаКомпоновкиДанных = Объект_из_строки(СхемаКомпоновкиДанныхСтрокой);
	Возврат СхемаКомпоновкиДанных.Параметры[ИмяПараметра].Значение;
КонецФункции


Процедура УстановитьПараметрКомпоновщика(ИмяПараметра, ЗначениеПараметра) Экспорт
	КомпоновщикНастроек
					.Настройки
					.ПараметрыДанных
					.НайтиЗначениеПараметра
						(Новый ПараметрКомпоновкиДанных(ИмяПараметра))
						
					.Значение = ЗначениеПараметра;
КонецПроцедуры

Процедура УстановитьПараметрСКД(ИмяПараметра, ЗначениеПараметра)
	СхемаКомпоновкиДанных = Объект_из_строки(СхемаКомпоновкиДанныхСтрокой);
	СхемаКомпоновкиДанных.Параметры[ИмяПараметра] = ЗначениеПараметра;
	СхемаКомпоновкиДанныхСтрокой = Объект_в_строку(СхемаКомпоновкиДанных);
КонецПроцедуры


Процедура УстановитьНастройкиПоУмолчанию() Экспорт
	
	СхемаКомпоновкиДанных = Объект_из_строки(СхемаКомпоновкиДанныхСтрокой);
	КомпоновщикНастроек.Инициализировать(Новый ИсточникДоступныхНастроекКомпоновкиДанных(СхемаКомпоновкиДанных));
	КомпоновщикНастроек.ЗагрузитьНастройки(СхемаКомпоновкиДанных.НастройкиПоУмолчанию);
	
КонецПроцедуры

Функция Объект_в_строку(СериализуемыйОбъект)
	
	Сериализатор = Новый СериализаторXDTO(ФабрикаXDTO);
	ОбъектXDTO = Сериализатор.ЗаписатьXDTO(СериализуемыйОбъект);	
	
	ЗаписьXML = Новый ЗаписьXML; 
	ЗаписьXML.УстановитьСтроку("UTF-8"); 
	ЗаписьXML.ЗаписатьОбъявлениеXML();
	ФабрикаXDTO.ЗаписатьXML(ЗаписьXML, ОбъектXDTO,,,,НазначениеТипаXML.Явное); 
	
	Возврат ЗаписьXML.Закрыть();
	
КонецФункции

Функция Объект_из_строки(Строка)
	
	ЧтениеXML = Новый ЧтениеXML(); 
	ЧтениеXML.УстановитьСтроку(Строка);
	ЧтениеXML.Прочитать();
	ОбъектXDTO = ФабрикаXDTO.ПрочитатьXML(ЧтениеXML);
	
	Сериализатор = Новый СериализаторXDTO(ФабрикаXDTO);
	Возврат Сериализатор.ПрочитатьXDTO(ОбъектXDTO);	
	
КонецФункции

Процедура ОбновитьСхемуКомпоновкиДанных(ИмяМакета) Экспорт
	// TODO 
	// 1. Сгенерировать наборы данных
	// 2. Сгенерировать структуру
	
	СхемаКомпоновкиДанных = ПолучитьМакет(ИмяМакета);
	
	СхемаКомпоновкиДанныхСтрокой = Объект_в_строку(СхемаКомпоновкиДанных);
КонецПроцедуры

Процедура ПриКомпоновкеРезультата(ДокументРезультат, ДанныеРасшифровки, СтандартнаяОбработка)
	
	ПараметрКД = ПолучитьПараметрКомпоновщика("Документ");
	ОбновитьСхемуКомпоновкиДанных(ПараметрКД);
	УстановитьНастройкиПоУмолчанию();
	УстановитьПараметрКомпоновщика("Документ", ПараметрКД);
	
КонецПроцедуры

СхемаКомпоновкиДанныхСтрокой = Объект_в_строку(СхемаКомпоновкиДанных);

